<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: .NET | .NET, Sitecore and setup development]]></title>
  <link href="http://yansklyarenko.github.io/blog/categories/dot-net/atom.xml" rel="self"/>
  <link href="http://yansklyarenko.github.io/"/>
  <updated>2017-11-07T00:46:58+02:00</updated>
  <id>http://yansklyarenko.github.io/</id>
  <author>
    <name><![CDATA[Yan Sklyarenko]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[A solution can build fine from inside the Visual Studio, but fail to build with msbuild.exe]]></title>
    <link href="http://yansklyarenko.github.io/blog/2012/10/29/a-solution-can-build-fine-from-inside/"/>
    <updated>2012-10-29T16:35:00+02:00</updated>
    <id>http://yansklyarenko.github.io/blog/2012/10/29/a-solution-can-build-fine-from-inside</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">Today I have faced with an interesting issue. Although I failed to reproduce it on a fresh new project, I think this info might be useful for others.<br />I have a solution which was upgraded from targeting .NET Framework 2.0 to .NET Framework 3.5. I’ve got a patch from a fellow developer to apply to one of the projects of that solution. The patch adds new files as well as modifies existing ones. After the patch application, the solution is successfully built from inside the Visual Studio, but fails to build from the command line with msbuild.exe. The error thrown states that <br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:5c70df5d-f802-466e-9713-c35fabc6dfbb" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: c#;">“The type or namespace name 'Linq' does not exist in the namespace 'System' ”. </pre></div>The msbuild version is 3.5:<br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:5d034399-054f-4ebd-aabb-73bf9dab56bf" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: c#;">[exec] Microsoft (R) Build Engine Version 3.5.30729.5420<br />[exec] [Microsoft .NET Framework, Version 2.0.50727.5456]<br />[exec] Copyright (C) Microsoft Corporation 2007. All rights reserved.</pre></div>It turns out <a href="http://connect.microsoft.com/VisualStudio/feedback/details/665406/using-system-linq-without-reference-to-system-core-compiles-in-vs-but-not-with-msbuild-exe" target="_blank">this issue has been met by other people</a>, and even reported to Microsoft. Microsoft suggested to use MSBuild.exe 4.0 to build VS 2010 projects. However, they confirmed it is possible to use MSBuild.exe 3.5&nbsp; - in this case a reference to System.Core (3.5.0.0) must be explicitly added to the csproj file.<br />If you try to add a reference to System.Core from inside the Visual Studio, you’ll get the error saying:<br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:d25d09ad-d4a7-4cd3-8b89-6959ec9d1e60" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: c#;">"A reference to 'System.Core' could not be added. This component is already automatically referenced by the build system"</pre></div>So, it seems that when you build a solution from inside the Visual Studio, it is capable to automatically load implicitly referenced assemblies. I suppose, MSBuild.exe 4.0 (and even SP1-patched MSBuild.exe 3.5?) can do this as well. Apparently, this has also <a href="http://blog.rlucas.net/bugfix/force-a-reference-to-system-core-in-visual-studio-2010/" target="_blank">turned out to be a known problem</a> – you can’t add that reference from the IDE. Open csproj file in your favorite editor and add this:<br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:cd2bda3a-a055-467e-85d3-7913a99c7de4" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: xml;">&lt;Reference Include="System.Core" /&gt;</pre></div>After this, the project builds fine in both VS and MSBuild.</div></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Default attribute values for custom NAnt tasks]]></title>
    <link href="http://yansklyarenko.github.io/blog/2012/08/15/default-attribute-values-for-custom/"/>
    <updated>2012-08-15T16:35:00+03:00</updated>
    <id>http://yansklyarenko.github.io/blog/2012/08/15/default-attribute-values-for-custom</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">When you create custom <a href="http://nant.sourceforge.net/">NAnt</a> tasks, you can specify various task parameter characteristics, such as whether it is a required attribute, how it validates its value, etc. This is done via the custom attributes in .NET, for example: <br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:035f0705-3d6e-49d1-b4f6-f204a32b007f" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: c#;">[TaskAttribute("param", Required = true), StringValidator(AllowEmpty = false)]<br />public string Param { get; set; }</pre></div>It might be a good idea to be able to specify a default value for a task parameter the similar way, for instance:<br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:ab15929c-f17e-4af8-a9f7-002707f23da4" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: c#;">[TaskAttribute("port"), Int32Validator(1000, 65520), DefaultValue(16333)]<br />public int Port { get; set; }</pre></div>Let’s examine the way it can be implemented. First of all, let’s define the custom attribute for the default value:<br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:9610860a-ef97-4b43-b9fb-53404ae7af97" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: c#;">/// &lt;summary&gt;<br />/// The custom attribute for the task attribute default value<br />/// &lt;/summary&gt;<br />public class DefaultValueAttribute : Attribute<br />{<br />  public DefaultValueAttribute(object value)<br />  {<br />    this.Default = value;<br />  }<br /><br />  public object Default { get; set; }<br />}</pre></div>I suppose the <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.defaultvalueattribute.aspx">standard .NET DefaultValueAttribute</a> can be used for this purpose as well, but the one above is very simple and is good for this sample. Note also that in this situation we could benefit from the generic custom attributes, <a href="http://stackoverflow.com/questions/294216/why-does-c-sharp-forbid-generic-attribute-types">which unfortunately are not supported in C#, although are quite valid for CLR</a>.<br /><br />Now, when the attribute is defined, let’s design the way default values will be applied at runtime. For this purpose we’ll have to define a special base class for all our custom tasks we’d like to use default values technique:<br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:d0e399ab-d366-4d25-babe-725de7760c30" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: c#;">public abstract class DefaultValueAwareTask : Task<br />{<br />  protected override void ExecuteTask()<br />  {<br />    this.SetDefaultValues();<br />  }<br /><br />  protected virtual void SetDefaultValues()<br />  {<br />    foreach (var property in GetPropertiesWithCustomAttributes&lt;DefaultValueAttribute&gt;(this.GetType()))<br />    {<br />      var attribute = (TaskAttributeAttribute)property.GetCustomAttributes(typeof(TaskAttributeAttribute), false)[0];<br />      var attributeDefaultValue = (DefaultValueAttribute)property.GetCustomAttributes(typeof(DefaultValueAttribute), false)[0];<br /><br />      if (attribute.Required)<br />      {<br />        throw new BuildException("No reason to allow both to be set", this.Location);<br />      }<br /><br />      if (this.XmlNode.Attributes[attribute.Name] == null)<br />      {<br />        property.SetValue(this, attributeDefaultValue.Default, null);<br />      }<br />    }<br />  }<br /><br />  private static IEnumerable&lt;PropertyInfo&gt; GetPropertiesWithCustomAttributes&lt;T&gt;(Type type)<br />  {<br />    return type.GetProperties(BindingFlags.DeclaredOnly | BindingFlags.Public | BindingFlags.Instance).Where(property =&gt; property.GetCustomAttributes(typeof(T), false).Length &gt; 0);<br />  }<br />}</pre></div>Let’s examine what this code actually does. The key method here is SetDefaultValues(). It iterates through the task parameters (the public properties marked with DefaultValueAttribute attribute) of the class it is defined in and checks whether the value carried by the DefaultValueAttribute should be set as a true value of the task parameter. It is quite simple: if the XmlNode of the NAnt task definition doesn’t contain the parameter in question, it means a developer didn’t set it explicitly, and it is necessary to set a default value. Moreover, if the task parameter is marked as Required and has a default value at the same time, this situation is treated as not appropriate and the exception is thrown.<br /><br />Obviously, when a custom NAnt task derives from the DefaultValueAwareTask, it has to call base.ExecuteTask() at the very start of its ExecuteTask() method implementation for this technique to work.</div></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Generate a solution file for a number of C# projects files in a folder]]></title>
    <link href="http://yansklyarenko.github.io/blog/2012/07/06/generate-solution-file-for-number-of-c/"/>
    <updated>2012-07-06T14:59:00+03:00</updated>
    <id>http://yansklyarenko.github.io/blog/2012/07/06/generate-solution-file-for-number-of-c</id>
    <content type="html"><![CDATA[<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">Some time ago I wrote my first T4 template which generates a solution (*.sln) file out of a number of C# project (*.cspoj) files, located in a folder and all descendants. Although it turned out not to be necessary to solve the task I was working on, and assuming it’s quite simple, I still decided to share it for further reference. May someone can find it useful. So, below is the entire T4 template, with no extra comments:<br /><div class="wlWriterEditableSmartContent" id="scid:f32c3428-b7e9-4f15-a8ea-c502c7ff2e88:260cba0a-462d-4da5-bf82-2a4da7bd7cdf" style="display: inline; float: none; margin: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;"><pre class="brush: c#;gutter:false;wrap-lines:false;">Microsoft Visual Studio Solution File, Format Version 11.00<br /># Visual Studio 2010<br />&lt;#@ template language="cs" hostspecific="false" #&gt;<br />&lt;#@ output extension=".sln" #&gt;<br />&lt;#@ parameter name="Folder" type="System.String" #&gt; <br />&lt;#@ assembly name="System.Core" #&gt;<br />&lt;#@ assembly name="System.Xml" #&gt;<br />&lt;#@ assembly name="System.Xml.Linq" #&gt;<br />&lt;#@ import namespace="System.IO" #&gt;<br />&lt;#@ import namespace="System.Linq" #&gt;<br />&lt;#@ import namespace="System.Xml.Linq" #&gt; <br />&lt;#<br />    if (Directory.Exists(Folder))<br />    {<br />        var csprojFiles= Directory.GetFiles(Folder, "*.csproj", SearchOption.AllDirectories);<br />        foreach (var file in csprojFiles)<br />        {<br />            ProjectFileMetaData metaData = new ProjectFileMetaData(file, Folder);<br />            WriteLine("Project(\"{3}\") = \"{0}\", \"{1}\", \"{2}\"",  metaData.Name, metaData.Path, metaData.Id, ProjectFileMetaData.ProjectTypeGuid);<br />            WriteLine("EndProject");<br />        }<br />    }<br />#&gt;<br /><br />&lt;#+ <br />    public class ProjectFileMetaData<br />    {<br />        public static string ProjectTypeGuid = "{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}";<br /><br />        public ProjectFileMetaData(string file, string root)<br />        {<br />            InitProperties(file, root);<br />        }<br /><br />        public string Name { get; set; }<br /><br />        public string Path { get; set; }<br /><br />        public string Id { get; set; }<br /><br />        private void InitProperties(string file, string root)<br />        {<br />            XDocument xDoc = XDocument.Load(file);<br />            XNamespace ns = @"http://schemas.microsoft.com/developer/msbuild/2003";<br />            XElement xElement = xDoc.Root.Elements(XName.Get("PropertyGroup", ns.NamespaceName)).First().Element(XName.Get("ProjectGuid", ns.NamespaceName));<br />            if (xElement != null)<br />            {<br />                this.Id = xElement.Value;<br />            }<br /><br />            this.Path = file.Substring(root.Length).TrimStart(new char[] { '\\' });<br /><br />            this.Name = System.IO.Path.GetFileNameWithoutExtension(file);<br />        }<br />    }<br />#&gt;</pre></div></div></div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[A warning to VB.NET developers]]></title>
    <link href="http://yansklyarenko.github.io/blog/2009/08/16/warning-to-vbnet-developers/"/>
    <updated>2009-08-16T23:43:00+03:00</updated>
    <id>http://yansklyarenko.github.io/blog/2009/08/16/warning-to-vbnet-developers</id>
    <content type="html"><![CDATA[<div class='post'>
<p>Avoid defining methods with default arguments!</p>  <p>Today I have been exploring the “Member design” chapter of a great book of <a href="http://blogs.msdn.com/kcwalina/">Cwalina</a>/<a href="http://blogs.msdn.com/brada/">Abrams</a> “<a href="http://www.amazon.com/Framework-Design-Guidelines-Conventions-Development/dp/0321545613/ref=dp_ob_title_bk">Framework Design Guidelines</a>”, and found a guideline which shocked me a bit. No, the guideline itself is correct and valuable. I just was never thinking it works like this.</p>  <p>VB.NET has a language feature called default arguments. When you define a method in your class, you can specify default values to the optional parameters to be taken when this parameter is omitted. As far as I understand, this is a kind of alternative to the method overloading. </p>  <p>Consider the following code:</p>  <p><font color="#0000ff">Public Class DefaultValues      <br />&#160;&#160;&#160; Public Function Sum(ByVal a As Integer, Optional ByVal b As Integer =</font> <strong><font color="#ff0000">100</font></strong><font color="#0000ff">)      <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Sum = a + b       <br />&#160;&#160;&#160; End Function       <br />&#160; End Class</font></p>  <p>(I speak C# myself, so excuse me my poor VB ;-))</p>  <p>Let’s say we compile this code into a DLL and we have a client console application to utilize that library:</p>  <p><font color="#0000ff">Module TestDefaultValues      <br />&#160;&#160;&#160; Sub Main()       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Dim df As DefaultValues.DefaultValues = New DefaultValues.DefaultValues()       <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Console.WriteLine(df.Sum(<strong><font color="#ff0000">55</font></strong>))       <br />&#160;&#160;&#160; End Sub       <br />&#160; End Module</font></p>  <p>Compile everything and run TestDefaultValues.exe. The result is predictable: <strong><font color="#ff0000">155</font></strong>.</p>  <p>Now change the default value from 100 to 200 and compile only the library. DO NOT recompile the client application. Run it again, and it is still <strong><font color="#ff0000">155</font></strong>!</p>  <p>This is why it is strongly not recommended to use default arguments instead of normal method overloading. And this issue is why C# doesn’t expose this technique. </p>  <p>Be careful, VB.NET developers! And long live C#! :-)</p>  </div>

]]></content>
  </entry>
  
</feed>
